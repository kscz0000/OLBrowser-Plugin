<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰å…¨æµ‹è¯•éªŒè¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 40px;
            font-size: 2.5rem;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .test-section h2 {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .test-case {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .test-case h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }

        .test-result.pass {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .summary {
            margin-top: 40px;
            padding: 20px;
            background: #e7f3ff;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }

        .summary h2 {
            color: #0c4a6e;
            margin-bottom: 15px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-card .label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ å›¾åƒå¤„ç†æ’ä»¶å®‰å…¨æµ‹è¯•éªŒè¯</h1>

        <div class="summary">
            <h2>æµ‹è¯•æ‘˜è¦</h2>
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="number" id="totalTests">0</div>
                    <div class="label">æ€»æµ‹è¯•æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="passedTests">0</div>
                    <div class="label">é€šè¿‡æµ‹è¯•</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="failedTests">0</div>
                    <div class="label">å¤±è´¥æµ‹è¯•</div>
                </div>
                <div class="stat-card">
                    <div class="number" id="passRate">0%</div>
                    <div class="label">é€šè¿‡ç‡</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>1. XSSæ”»å‡»é˜²æŠ¤æµ‹è¯•</h2>
            
            <div class="test-case">
                <h3>æµ‹è¯•1.1: æ¶æ„è„šæœ¬æ³¨å…¥é˜²æŠ¤</h3>
                <p>æµ‹è¯•SVGä¸­åŒ…å«æ¶æ„scriptæ ‡ç­¾çš„æƒ…å†µ</p>
                <div class="code-block">
&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
    &lt;script&gt;alert('XSSæ”»å‡»')&lt;/script&gt;
    &lt;circle cx="50" cy="50" r="40" /&gt;
&lt;/svg&gt;
                </div>
                <button onclick="testXSSScript()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-xss-script" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <div class="test-case">
                <h3>æµ‹è¯•1.2: äº‹ä»¶å¤„ç†å™¨æ³¨å…¥é˜²æŠ¤</h3>
                <p>æµ‹è¯•SVGä¸­åŒ…å«äº‹ä»¶å¤„ç†å™¨çš„æƒ…å†µ</p>
                <div class="code-block">
&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
    &lt;circle cx="50" cy="50" r="40" onclick="alert('XSS')" /&gt;
&lt;/svg&gt;
                </div>
                <button onclick="testXSSEventHandler()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-xss-event" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <div class="test-case">
                <h3>æµ‹è¯•1.3: JavaScriptåè®®è¿‡æ»¤</h3>
                <p>æµ‹è¯•SVGä¸­åŒ…å«javascript:åè®®çš„æƒ…å†µ</p>
                <div class="code-block">
&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
    &lt;a href="javascript:alert('XSS')"&gt;ç‚¹å‡»&lt;/a&gt;
&lt;/svg&gt;
                </div>
                <button onclick="testXSSJavaScriptProtocol()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-xss-js" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>

        <div class="test-section">
            <h2>2. XXEæ”»å‡»é˜²æŠ¤æµ‹è¯•</h2>
            
            <div class="test-case">
                <h3>æµ‹è¯•2.1: DOCTYPEå£°æ˜ç§»é™¤</h3>
                <p>æµ‹è¯•DOCTYPEå£°æ˜æ˜¯å¦è¢«æ­£ç¡®ç§»é™¤</p>
                <div class="code-block">
&lt;!DOCTYPE svg SYSTEM "http://example.com/malicious.dtd"&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
    &lt;circle cx="50" cy="50" r="40" /&gt;
&lt;/svg&gt;
                </div>
                <button onclick="testXXEDoctype()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-xxe-doctype" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <div class="test-case">
                <h3>æµ‹è¯•2.2: XMLå®ä½“å£°æ˜ç§»é™¤</h3>
                <p>æµ‹è¯•XMLå®ä½“å£°æ˜æ˜¯å¦è¢«æ­£ç¡®ç§»é™¤</p>
                <div class="code-block">
&lt;!ENTITY xxe SYSTEM "http://example.com/malicious.xml"&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
    &lt;circle cx="50" cy="50" r="40" /&gt;
&lt;/svg&gt;
                </div>
                <button onclick="testXXEEntity()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-xxe-entity" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>

        <div class="test-section">
            <h2>3. SVGç‚¸å¼¹æ£€æµ‹æµ‹è¯•</h2>
            
            <div class="test-case">
                <h3>æµ‹è¯•3.1: å…ƒç´ æ•°é‡é™åˆ¶</h3>
                <p>æµ‹è¯•è¿‡å¤šå…ƒç´ çš„SVGæ˜¯å¦è¢«æ‹’ç»</p>
                <button onclick="testSvgBombElements()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-svg-bomb-elements" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <div class="test-case">
                <h3>æµ‹è¯•3.2: åµŒå¥—æ·±åº¦é™åˆ¶</h3>
                <p>æµ‹è¯•æ·±åº¦åµŒå¥—çš„SVGæ˜¯å¦è¢«æ‹’ç»</p>
                <button onclick="testSvgBombNesting()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-svg-bomb-nesting" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <div class="test-case">
                <h3>æµ‹è¯•3.3: åŠ¨ç”»æŒç»­æ—¶é—´é™åˆ¶</h3>
                <p>æµ‹è¯•é•¿åŠ¨ç”»çš„SVGæ˜¯å¦è¢«æ‹’ç»</p>
                <button onclick="testSvgBombAnimation()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-svg-bomb-animation" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>

        <div class="test-section">
            <h2>4. æ–‡ä»¶éªŒè¯æµ‹è¯•</h2>
            
            <div class="test-case">
                <h3>æµ‹è¯•4.1: å±é™©æ–‡ä»¶ç±»å‹æ‹’ç»</h3>
                <p>æµ‹è¯•å±é™©æ–‡ä»¶æ‰©å±•åæ˜¯å¦è¢«æ‹’ç»</p>
                <button onclick="testDangerousFile()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-dangerous-file" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>

            <div class="test-case">
                <h3>æµ‹è¯•4.2: æ–‡ä»¶å¤§å°é™åˆ¶</h3>
                <p>æµ‹è¯•è¿‡å¤§æ–‡ä»¶æ˜¯å¦è¢«æ‹’ç»</p>
                <button onclick="testFileSizeLimit()">è¿è¡Œæµ‹è¯•</button>
                <div id="result-file-size" class="test-result info">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px;">
            <button onclick="runAllTests()" style="font-size: 1.2rem; padding: 15px 40px;">
                ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•
            </button>
        </div>
    </div>

    <script src="../shared/svg-security.js"></script>
    <script src="../shared/file-validator.js"></script>
    <script>
        // æµ‹è¯•ç»Ÿè®¡
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0
        };

        // æ›´æ–°æµ‹è¯•ç»Ÿè®¡
        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
            const passRate = testStats.total > 0 ? ((testStats.passed / testStats.total) * 100).toFixed(1) : 0;
            document.getElementById('passRate').textContent = passRate + '%';
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(elementId, passed, message) {
            const element = document.getElementById(elementId);
            element.className = 'test-result ' + (passed ? 'pass' : 'fail');
            element.textContent = (passed ? 'âœ“ é€šè¿‡: ' : 'âœ— å¤±è´¥: ') + message;
            
            testStats.total++;
            if (passed) {
                testStats.passed++;
            } else {
                testStats.failed++;
            }
            updateStats();
        }

        // XSSè„šæœ¬æ³¨å…¥æµ‹è¯•
        function testXSSScript() {
            const maliciousSvg = `<svg xmlns="http://www.w3.org/2000/svg">
    <script>alert('XSSæ”»å‡»')</script>
    <circle cx="50" cy="50" r="40" />
</svg>`;
            
            try {
                const result = SvgSecurity.sanitizeSvg(maliciousSvg);
                const passed = result.isValid && !result.cleanedSvg.includes('<script>');
                showResult('result-xss-script', passed, passed ? 'æ¶æ„scriptæ ‡ç­¾å·²è¢«ç§»é™¤' : 'XSSé˜²æŠ¤å¤±è´¥');
            } catch (error) {
                showResult('result-xss-script', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // XSSäº‹ä»¶å¤„ç†å™¨æµ‹è¯•
        function testXSSEventHandler() {
            const maliciousSvg = `<svg xmlns="http://www.w3.org/2000/svg">
    <circle cx="50" cy="50" r="40" onclick="alert('XSS')" />
</svg>`;
            
            try {
                const result = SvgSecurity.sanitizeSvg(maliciousSvg);
                const passed = result.isValid && !result.cleanedSvg.includes('onclick');
                showResult('result-xss-event', passed, passed ? 'äº‹ä»¶å¤„ç†å™¨å·²è¢«ç§»é™¤' : 'XSSé˜²æŠ¤å¤±è´¥');
            } catch (error) {
                showResult('result-xss-event', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // XSS JavaScriptåè®®æµ‹è¯•
        function testXSSJavaScriptProtocol() {
            const maliciousSvg = `<svg xmlns="http://www.w3.org/2000/svg">
    <a href="javascript:alert('XSS')">ç‚¹å‡»</a>
</svg>`;
            
            try {
                const result = SvgSecurity.sanitizeSvg(maliciousSvg);
                const passed = result.isValid && !result.cleanedSvg.includes('javascript:');
                showResult('result-xss-js', passed, passed ? 'JavaScriptåè®®å·²è¢«è¿‡æ»¤' : 'XSSé˜²æŠ¤å¤±è´¥');
            } catch (error) {
                showResult('result-xss-js', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // XXE DOCTYPEæµ‹è¯•
        function testXXEDoctype() {
            const maliciousSvg = `<!DOCTYPE svg SYSTEM "http://example.com/malicious.dtd">
<svg xmlns="http://www.w3.org/2000/svg">
    <circle cx="50" cy="50" r="40" />
</svg>`;
            
            try {
                const result = SvgSecurity.sanitizeSvg(maliciousSvg);
                const passed = result.isValid && !result.cleanedSvg.includes('<!DOCTYPE');
                showResult('result-xxe-doctype', passed, passed ? 'DOCTYPEå£°æ˜å·²è¢«ç§»é™¤' : 'XXEé˜²æŠ¤å¤±è´¥');
            } catch (error) {
                showResult('result-xxe-doctype', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // XXEå®ä½“æµ‹è¯•
        function testXXEEntity() {
            const maliciousSvg = `<!ENTITY xxe SYSTEM "http://example.com/malicious.xml">
<svg xmlns="http://www.w3.org/2000/svg">
    <circle cx="50" cy="50" r="40" />
</svg>`;
            
            try {
                const result = SvgSecurity.sanitizeSvg(maliciousSvg);
                const passed = result.isValid && !result.cleanedSvg.includes('<!ENTITY');
                showResult('result-xxe-entity', passed, passed ? 'XMLå®ä½“å£°æ˜å·²è¢«ç§»é™¤' : 'XXEé˜²æŠ¤å¤±è´¥');
            } catch (error) {
                showResult('result-xxe-entity', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // SVGç‚¸å¼¹å…ƒç´ æ•°é‡æµ‹è¯•
        function testSvgBombElements() {
            let svg = '<svg xmlns="http://www.w3.org/2000/svg">';
            for (let i = 0; i < 11000; i++) {
                svg += `<circle cx="${i}" cy="${i}" r="1" />`;
            }
            svg += '</svg>';
            
            try {
                const result = SvgSecurity.sanitizeSvg(svg);
                const passed = !result.isValid && result.errors.some(err => err.includes('å…ƒç´ '));
                showResult('result-svg-bomb-elements', passed, passed ? 'å…ƒç´ æ•°é‡é™åˆ¶ç”Ÿæ•ˆ' : 'SVGç‚¸å¼¹é˜²æŠ¤å¤±è´¥');
            } catch (error) {
                showResult('result-svg-bomb-elements', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // SVGç‚¸å¼¹åµŒå¥—æ·±åº¦æµ‹è¯•
        function testSvgBombNesting() {
            let svg = '<svg xmlns="http://www.w3.org/2000/svg">';
            let current = svg;
            for (let i = 0; i < 110; i++) {
                current += `<g>`;
            }
            for (let i = 0; i < 110; i++) {
                current += `<circle cx="50" cy="50" r="40" /></g>`;
            }
            current += '</svg>';
            
            try {
                const result = SvgSecurity.sanitizeSvg(current);
                const passed = !result.isValid && result.errors.some(err => err.includes('åµŒå¥—'));
                showResult('result-svg-bomb-nesting', passed, passed ? 'åµŒå¥—æ·±åº¦é™åˆ¶ç”Ÿæ•ˆ' : 'SVGç‚¸å¼¹é˜²æŠ¤å¤±è´¥');
            } catch (error) {
                showResult('result-svg-bomb-nesting', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // SVGç‚¸å¼¹åŠ¨ç”»æµ‹è¯•
        function testSvgBombAnimation() {
            const maliciousSvg = `<svg xmlns="http://www.w3.org/2000/svg">
    <circle cx="50" cy="50" r="40">
        <animate attributeName="r" from="10" to="50" dur="20000ms" />
    </circle>
</svg>`;
            
            try {
                const result = SvgSecurity.sanitizeSvg(maliciousSvg);
                const passed = !result.isValid && result.errors.some(err => err.includes('åŠ¨ç”»'));
                showResult('result-svg-bomb-animation', passed, passed ? 'åŠ¨ç”»æŒç»­æ—¶é—´é™åˆ¶ç”Ÿæ•ˆ' : 'SVGç‚¸å¼¹é˜²æŠ¤å¤±è´¥');
            } catch (error) {
                showResult('result-svg-bomb-animation', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // å±é™©æ–‡ä»¶æµ‹è¯•
        function testDangerousFile() {
            const file = new File(['test'], 'test.exe', { type: 'application/x-msdownload' });
            
            try {
                const result = FileValidator.validateFile(file);
                const passed = !result.isValid && result.errors.some(err => err.includes('ä¸å…è®¸'));
                showResult('result-dangerous-file', passed, passed ? 'å±é™©æ–‡ä»¶ç±»å‹å·²è¢«æ‹’ç»' : 'æ–‡ä»¶éªŒè¯å¤±è´¥');
            } catch (error) {
                showResult('result-dangerous-file', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // æ–‡ä»¶å¤§å°é™åˆ¶æµ‹è¯•
        function testFileSizeLimit() {
            const largeContent = new Array(60 * 1024 * 1024).fill('x').join('');
            const file = new File([largeContent], 'large.jpg', { type: 'image/jpeg' });
            
            try {
                const result = FileValidator.validateFile(file);
                const passed = !result.isValid && result.errors.some(err => err.includes('æ–‡ä»¶è¿‡å¤§'));
                showResult('result-file-size', passed, passed ? 'å¤§æ–‡ä»¶å·²è¢«æ‹’ç»' : 'æ–‡ä»¶å¤§å°é™åˆ¶å¤±è´¥');
            } catch (error) {
                showResult('result-file-size', false, 'æµ‹è¯•å‡ºé”™: ' + error.message);
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            testStats = { total: 0, passed: 0, failed: 0 };
            updateStats();
            
            testXSSScript();
            testXSSEventHandler();
            testXSSJavaScriptProtocol();
            testXXEDoctype();
            testXXEEntity();
            testSvgBombElements();
            testSvgBombNesting();
            testSvgBombAnimation();
            testDangerousFile();
            testFileSizeLimit();
        }
    </script>
</body>
</html>