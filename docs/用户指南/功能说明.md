# 功能说明

本文档详细说明了图像处理工具箱的所有功能和使用方法。

---

## 目录

- [图像压缩](#1-图像压缩)
- [SVG 转图片](#2-svg-转图片)
- [PPTX 处理](#3-pptx-处理)
- [多语言支持](#4-多语言支持)
- [主题切换](#5-主题切换)
- [高级功能](#6-高级功能)

---

## 1. 图像压缩

### 支持的格式

- **PNG**：无损压缩，适合透明背景图片
- **JPG/JPEG**：有损压缩，适合照片类图片
- **WebP**：现代格式，体积更小，质量更好
- **GIF**：支持简单动画，最大 20MB
- **BMP**：无损格式，文件较大
- **PPTX**：演示文稿，可自动提取图片

### 压缩参数

#### 压缩质量（1-100 级）

| 质量级别 | 压缩率 | 适用场景 |
|-----------|---------|----------|
| 1-30 | 极高 | 小体积优先，如网页图片 |
| 31-70 | 高 | 平衡质量和体积 |
| 71-90 | 中等 | 推荐值，适合大多数场景 |
| 91-100 | 低 | 最高质量，体积较大 |

#### 尺寸调整预设

- **自动**：保持原始尺寸，不进行缩放
- **75%**：缩小到原始尺寸的 75%
- **50%**：缩小到原始尺寸的 50%
- **25%**：缩小到原始尺寸的 25%
- **1920px**：限制图片长边为 1920 像素，保持比例
- **1280px**：限制图片长边为 1280 像素，保持比例

#### 输出格式

- **PNG**：适合透明背景、图标、Logo
- **JPG**：适合照片、风景图、复杂图片
- **WebP**：现代格式，体积小，质量优
- **GIF**：适合简单动画
- **BMP**：无损格式，但文件较大

### 智能去重

- **自动识别**：通过文件内容哈希（SHA-256）识别重复图片
- **提示用户**：发现重复时询问是否跳过
- **节省时间**：避免重复处理相同图片

### 批量处理

- **并发控制**：智能管理多个文件同时处理，最大并发数 3
- **进度显示**：实时显示每个文件的处理进度
- **结果预览**：压缩前后对比，显示文件大小和压缩率

---

## 2. SVG 转图片

### 输入方式

#### 方式一：文件上传

- **拖拽上传**：直接拖拽 SVG 文件到上传区域
- **点击选择**：点击上传区域选择文件
- **批量选择**：一次可选择多个 SVG 文件

#### 方式二：代码粘贴

- **直接粘贴**：在文本框中粘贴 SVG 代码
- **自动识别**：自动识别粘贴的 SVG 代码
- **添加到列表**：点击「添加到任务列表」按钮
- **批量添加**：可多次粘贴添加多个 SVG

### 转换参数

#### 输出格式

- **PNG**：无损格式，支持透明背景
- **JPG**：有损格式，适合网络传输

#### 分辨率倍数

| 倍数 | 输出尺寸 | 适用场景 |
|-----|---------|----------|
| 1x（标准） | 原始尺寸 | 普通使用 |
| 2x（2K） | 原始 ×2 | 高清显示、印刷 |
| 3x（4K） | 原始 ×3 | 超高清显示 |
| 4x（8K） | 原始 ×4 | 极高清显示、大尺寸打印 |

#### 图片质量（仅 JPG）

- **1-10 级**：1 最低，10 最高
- **质量选择建议**：
  - 网络使用：3-5 级
  - 存储使用：6-8 级
  - 打印使用：8-10 级

### 安全处理

#### SVG 安全清理

- **危险标签过滤**：移除 `script`、`iframe`、`object` 等标签
- **危险属性过滤**：移除 `onclick`、`onload` 等事件处理器
- **XXE 防护**：防止 XML 外部实体注入攻击
- **SVG 炸弹检测**：限制元素数量和嵌套深度

### 批量转换

- **任务队列**：支持多任务并发处理
- **进度追踪**：实时显示每个任务状态
- **批量下载**：一键下载所有转换结果

---

## 3. PPTX 处理

### 自动提取图片

- **智能识别**：自动提取 PPTX 文件中所有嵌入的图片
- **格式支持**：支持常见的图片格式（PNG、JPG、WebP 等）
- **路径过滤**：自动排除系统图片和主题文件
- **最小尺寸过滤**：过滤过小的图片（如小于 1KB）

### 哈希去重

- **SHA-256 计算**：为每张图片计算唯一哈希值
- **重复检测**：自动识别相同内容的图片
- **跳过提示**：发现重复时询问用户是否跳过

### 批量压缩

- **统一处理**：提取的图片自动进入压缩队列
- **参数共享**：可以使用统一的压缩设置处理所有图片
- **批量下载**：支持一键下载所有处理结果

---

## 4. 多语言支持

### 支持的语言

- **简体中文**：默认语言
- **English**：英文界面

### 语言切换

- **即时切换**：点击语言按钮后立即切换，无需刷新
- **自动保存**：语言偏好保存在本地浏览器中
- **下次访问**：下次打开插件时自动使用上次选择的语言

### 翻译覆盖

插件的所有界面文本都已翻译，包括：
- 功能名称和描述
- 按钮和标签文本
- 错误提示和成功消息
- 帮助和说明文字

---

## 5. 主题切换

### 支持的主题

- **浅色主题**：明亮、清爽的界面
- **深色主题**：黑暗、护眼的界面
- **跟随系统**：自动跟随操作系统的主题设置

### 主题切换

- **实时切换**：点击主题按钮后立即应用
- **自动保存**：主题偏好保存在本地浏览器中
- **全页面覆盖**：所有页面都支持主题切换

### 深色主题特点

- 降低对比度，适合长时间使用
- 减少眼睛疲劳，适合夜间使用
- 所有元素都经过深度适配

---

## 6. 高级功能

### 并发控制

- **智能调度**：自动管理任务队列，避免浏览器卡顿
- **最大并发数**：默认 3，可根据浏览器性能调整
- **优先级管理**：新任务优先处理
- **超时处理**：超时任务自动取消，释放资源

### 资源管理

- **自动清理**：定期清理不再使用的资源
- **内存监控**：监控内存使用，防止泄漏
- **URL 管理**：自动释放创建的临时 URL

### 性能优化

- **懒加载**：按需加载图片，减少初始加载时间
- **Web Worker**：使用 Web Worker 进行图片处理，避免阻塞主线程
- **缓存优化**：合理使用缓存，提升重复访问速度

### 错误处理

- **友好提示**：使用 Toast 提示替代原生 alert
- **错误恢复**：提供重试选项和错误详情
- **日志记录**：在控制台记录关键错误，便于调试

---

## 技术架构

### 前端技术栈

- **纯原生 JavaScript**：无框架依赖，轻量高效
- **HTML5 + CSS3**：现代 Web 标准
- **Canvas API**：用于图像处理和渲染
- **FileReader API**：用于文件读取和处理
- **Blob API**：用于文件生成和下载

### 模块化设计

- **shared/**：共享功能模块
  - `file-validator.js`：文件验证
  - `secure-storage.js`：安全存储
  - `svg-security.js`：SVG 安全处理
  - `pptx-processor.js`：PPTX 处理
  - `resource-manager.js`：资源管理
  - `concurrency-controller.js`：并发控制
  - `language-switch.js`：语言切换
  - `theme-switch.js`：主题切换

### 第三方库

- **JSZip**：用于 PPTX 文件解析
  - 版本：最新稳定版
  - 用途：解压缩和处理 PPTX 文件

---

## 浏览器兼容性

| 浏览器 | 最低版本 | Manifest V3 | 状态 |
|--------|----------|-------------|------|
| Chrome | 88+ | ✅ 完全支持 |
| Edge | 88+ | ✅ 完全支持 |
| Opera | 74+ | ✅ 完全支持 |
| Firefox | 109+ | ⚠️ 部分支持 |
| Brave | 88+ | ✅ 完全支持 |
| Vivaldi | 88+ | ✅ 完全支持 |

---

## 安全性

### 数据隐私

- **完全本地**：所有处理在浏览器本地完成
- **无数据上传**：不上传任何图片或用户数据
- **无跟踪**：不收集用户信息或使用行为
- **离线可用**：无需网络连接

### 安全防护

- **文件验证**：严格的 MIME 类型和扩展名验证
- **内容安全**：清理 SVG 中的危险代码
- **大小限制**：防止拒绝服务攻击
- **CSP 策略**：内容安全策略保护

---

## 更新日志

查看详细的版本更新历史，请参考 [CHANGELOG.md](../CHANGELOG.md)。

---

## 反馈与支持

- **问题反馈**：[提交 Issue](https://github.com/kscz0000/OLBrowser-Plugin/issues)
- **功能建议**：[提交 Feature Request](https://github.com/kscz0000/OLBrowser-Plugin/issues)
- **贡献代码**：阅读 [贡献指南](../CONTRIBUTING.md)

---

**文档更新时间**：2026 年 1 月  
**当前版本**：1.1.0
